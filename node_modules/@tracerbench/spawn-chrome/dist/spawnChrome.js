"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const find_chrome_1 = require("@tracerbench/find-chrome");
const spawn_1 = require("@tracerbench/spawn");
const canonicalizeOptions_1 = require("./canonicalizeOptions");
const createTmpDir_1 = require("./createTmpDir");
const getArguments_1 = require("./getArguments");
function spawnChrome(options, debugCallback) {
    const canonicalized = canonicalizeOptions_1.default(options);
    let chromeExecutable = canonicalized.chromeExecutable;
    if (chromeExecutable === undefined) {
        chromeExecutable = find_chrome_1.default();
    }
    let userDataDir = canonicalized.userDataDir;
    let removeTmp;
    if (userDataDir === undefined) {
        [userDataDir, removeTmp] = createTmpDir_1.default(canonicalized.userDataRoot);
    }
    const args = getArguments_1.default(userDataDir, canonicalized);
    const process = Object.assign(spawn_1.default(chromeExecutable, args, canonicalized.stdio, "pipe", debugCallback), {
        userDataDir,
    });
    if (removeTmp !== undefined) {
        process.once("exit", removeTmp);
    }
    return process;
}
exports.default = spawnChrome;
//# sourceMappingURL=spawnChrome.js.map